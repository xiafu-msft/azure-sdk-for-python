

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Azure Monitor &mdash; Azure SDK for Python 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="KeyVault" href="sample_azure-keyvault.html" />
    <link rel="prev" title="Batch" href="batch.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Azure SDK for Python
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart_authentication.html">Resource Management Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="multicloud.html">Multi-cloud - use Azure on all regions</a></li>
<li class="toctree-l1"><a class="reference internal" href="exceptions.html">Exception handling</a></li>
</ul>
<p class="caption"><span class="caption-text">Management Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagement.html">Resource Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagementapps.html">Apps Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagementbatch.html">Batch Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagementcdn.html">Content Delivery Network Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagementcomputenetwork.html">Compute and Network Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagementredis.html">Redis Cache Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagementscheduler.html">Scheduler Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="resourcemanagementstorage.html">Storage Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-authorization.html">Authorization Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-cognitiveservices.html">Cognitive Services Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-commerce.html">Commerce - Billing API</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-datalake-analytics.html">Azure Data Lake Management Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-datalake-store.html">Azure Data Lake Management Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-devtestlabs.html">DevTestLabs Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-dns.html">DNS Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-iothub.html">IoTHub Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-keyvault.html">KeyVault Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-manageddisks.html">Managed Disks</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-notificationhubs.html">Notification Hubs Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-powerbiembedded.html">PowerBI Embedded Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-servermanager.html">ServerManager Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-sql.html">SQL Database Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-mgmt-trafficmanager.html">Traffic Manager Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="servicemanagement.html">Service Management (Legacy)</a></li>
</ul>
<p class="caption"><span class="caption-text">Runtime Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="batch.html">Batch</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Azure Monitor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-the-monitor-client">Create the Monitor client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#registration">Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-the-activity-log">Get the Activity Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metrics">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#alert-rules">Alert rules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sample_azure-keyvault.html">KeyVault</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphrbac.html">Azure Active Directory Graph Rbac API</a></li>
<li class="toctree-l1"><a class="reference internal" href="servicebus.html">Service Bus</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.common.html">azure.common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.applicationinsights.html">azure.applicationinsights package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.batch.html">azure.batch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.language.spellcheck.html">azure.cognitiveservices.language.spellcheck package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.language.textanalytics.html">azure.cognitiveservices.language.textanalytics package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.search.customsearch.html">azure.cognitiveservices.search.customsearch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.search.entitysearch.html">azure.cognitiveservices.search.entitysearch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.search.imagesearch.html">azure.cognitiveservices.search.imagesearch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.search.newssearch.html">azure.cognitiveservices.search.newssearch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.search.videosearch.html">azure.cognitiveservices.search.videosearch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.search.visualsearch.html">azure.cognitiveservices.search.visualsearch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.search.websearch.html">azure.cognitiveservices.search.websearch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.vision.computervision.html">azure.cognitiveservices.vision.computervision package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.vision.contentmoderator.html">azure.cognitiveservices.vision.contentmoderator package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.vision.customvision.prediction.html">azure.cognitiveservices.vision.customvision.prediction package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.vision.customvision.training.html">azure.cognitiveservices.vision.customvision.training package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.cognitiveservices.vision.face.html">azure.cognitiveservices.vision.face package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.eventgrid.html">azure.eventgrid package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.graphrbac.html">azure.graphrbac package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.keyvault.html">azure.keyvault package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.loganalytics.html">azure.loganalytics package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.advisor.html">azure.mgmt.advisor package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.authorization.html">azure.mgmt.authorization package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.batch.html">azure.mgmt.batch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.batchai.html">azure.mgmt.batchai package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.billing.html">azure.mgmt.billing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.cdn.html">azure.mgmt.cdn package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.cognitiveservices.html">azure.mgmt.cognitiveservices package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.commerce.html">azure.mgmt.commerce package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.compute.html">azure.mgmt.compute package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.consumption.html">azure.mgmt.consumption package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.containerinstance.html">azure.mgmt.containerinstance package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.containerregistry.html">azure.mgmt.containerregistry package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.containerservice.html">azure.mgmt.containerservice package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.cosmosdb.html">azure.mgmt.cosmosdb package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.datafactory.html">azure.mgmt.datafactory package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.datalake.analytics.account.html">azure.mgmt.datalake.analytics.account package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.datalake.analytics.catalog.html">azure.mgmt.datalake.analytics.catalog package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.datalake.analytics.job.html">azure.mgmt.datalake.analytics.job package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.datalake.store.html">azure.mgmt.datalake.store package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.devtestlabs.html">azure.mgmt.devtestlabs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.dns.html">azure.mgmt.dns package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.eventgrid.html">azure.mgmt.eventgrid package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.eventhub.html">azure.mgmt.eventhub package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.hanaonazure.html">azure.mgmt.hanaonazure package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.hdinsight.html">azure.mgmt.hdinsight package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.iothub.html">azure.mgmt.iothub package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.iothubprovisioningservices.html">azure.mgmt.iothubprovisioningservices package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.keyvault.html">azure.mgmt.keyvault package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.loganalytics.html">azure.mgmt.loganalytics package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.logic.html">azure.mgmt.logic package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.machinelearningcompute.html">azure.mgmt.machinelearningcompute package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.managementgroups.html">azure.mgmt.managementgroups package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.media.html">azure.mgmt.media package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.monitor.html">azure.mgmt.monitor package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.msi.html">azure.mgmt.msi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.network.html">azure.mgmt.network package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.notificationhubs.html">azure.mgmt.notificationhubs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.policyinsights.html">azure.mgmt.policyinsights package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.powerbiembedded.html">azure.mgmt.powerbiembedded package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.rdbms.mysql.html">azure.mgmt.rdbms.mysql package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.rdbms.postgresql.html">azure.mgmt.rdbms.postgresql package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.recoveryservices.html">azure.mgmt.recoveryservices package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.recoveryservicesbackup.html">azure.mgmt.recoveryservicesbackup package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.redis.html">azure.mgmt.redis package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.relay.html">azure.mgmt.relay package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.resource.features.html">azure.mgmt.resource.features package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.resource.links.html">azure.mgmt.resource.links package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.resource.locks.html">azure.mgmt.resource.locks package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.resource.managedapplications.html">azure.mgmt.resource.managedapplications package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.resource.policy.html">azure.mgmt.resource.policy package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.resource.resources.html">azure.mgmt.resource.resources package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.resource.subscriptions.html">azure.mgmt.resource.subscriptions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.scheduler.html">azure.mgmt.scheduler package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.search.html">azure.mgmt.search package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.servermanager.html">azure.mgmt.servermanager package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.servicebus.html">azure.mgmt.servicebus package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.servicefabric.html">azure.mgmt.servicefabric package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.sql.html">azure.mgmt.sql package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.storage.html">azure.mgmt.storage package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.subscription.html">azure.mgmt.subscription package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.trafficmanager.html">azure.mgmt.trafficmanager package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.mgmt.web.html">azure.mgmt.web package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.servicefabric.html">azure.servicefabric package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.servicebus.html">azure.servicebus package</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref/azure.servicemanagement.html">azure.servicemanagement package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Azure SDK for Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Azure Monitor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sample_azure-monitor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="azure-monitor">
<h1>Azure Monitor<a class="headerlink" href="#azure-monitor" title="Permalink to this headline">¶</a></h1>
<p>For general information on resource management, see <a class="reference internal" href="resourcemanagement.html"><span class="doc">Resource Management</span></a>.</p>
<div class="section" id="create-the-monitor-client">
<h2>Create the Monitor client<a class="headerlink" href="#create-the-monitor-client" title="Permalink to this headline">¶</a></h2>
<p>The following code creates an instance of the client.</p>
<p>You will need to provide your <code class="docutils literal notranslate"><span class="pre">subscription_id</span></code> which can be retrieved
from <a class="reference external" href="https://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade">your subscription list</a>.</p>
<p>See <a class="reference internal" href="quickstart_authentication.html"><span class="doc">Resource Management Authentication</span></a>
for details on handling Azure Active Directory authentication with the Python SDK, and creating a <code class="docutils literal notranslate"><span class="pre">Credentials</span></code> instance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">azure.monitor</span> <span class="kn">import</span> <span class="n">MonitorClient</span>
<span class="kn">from</span> <span class="nn">azure.mgmt.monitor</span> <span class="kn">import</span> <span class="n">MonitorMgmtClient</span>
<span class="kn">from</span> <span class="nn">azure.common.credentials</span> <span class="kn">import</span> <span class="n">UserPassCredentials</span>

<span class="c1"># Replace this with your subscription id</span>
<span class="n">subscription_id</span> <span class="o">=</span> <span class="s1">&#39;33333333-3333-3333-3333-333333333333&#39;</span>

<span class="c1"># See above for details on creating different types of AAD credentials</span>
<span class="n">credentials</span> <span class="o">=</span> <span class="n">UserPassCredentials</span><span class="p">(</span>
    <span class="s1">&#39;user@domain.com&#39;</span><span class="p">,</span>  <span class="c1"># Your user</span>
    <span class="s1">&#39;my_password&#39;</span><span class="p">,</span>      <span class="c1"># Your password</span>
<span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">MonitorClient</span><span class="p">(</span>
    <span class="n">credentials</span><span class="p">,</span>
    <span class="n">subscription_id</span>
<span class="p">)</span>

<span class="n">monitor_mgmt_client</span> <span class="o">=</span> <span class="n">MonitorMgmtClient</span><span class="p">(</span>
    <span class="n">credentials</span><span class="p">,</span>
    <span class="n">subscription_id</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="registration">
<h2>Registration<a class="headerlink" href="#registration" title="Permalink to this headline">¶</a></h2>
<p>You also might need to add the “Monitoring Contributor Service Role” role
to your credentials. See here to do it using the Python CLI:
<a class="reference external" href="https://docs.microsoft.com/cli/azure/role/assignment">https://docs.microsoft.com/cli/azure/role/assignment</a></p>
</div>
<div class="section" id="get-the-activity-log">
<h2>Get the Activity Log<a class="headerlink" href="#get-the-activity-log" title="Permalink to this headline">¶</a></h2>
<p>This sample gets the logs from the ActivityLog of today for resource group ResourceGroupName,
filtering the attributes to get only the “eventName” and “operationName”.</p>
<p>A complete list of available keywords for filters and available attributes is available
here: <a class="reference external" href="https://msdn.microsoft.com/library/azure/dn931934.aspx">https://msdn.microsoft.com/library/azure/dn931934.aspx</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
    <span class="s2">&quot;eventTimestamp ge {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">today</span><span class="p">),</span>
    <span class="s2">&quot;resourceGroupName eq &#39;ResourceGroupName&#39;&quot;</span>
<span class="p">])</span>
<span class="n">select</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
    <span class="s2">&quot;eventName&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operationName&quot;</span>
<span class="p">])</span>

<span class="n">activity_logs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">activity_logs</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
    <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
    <span class="n">select</span><span class="o">=</span><span class="n">select</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">activity_logs</span><span class="p">:</span>
    <span class="c1"># assert isinstance(log, azure.monitor.models.EventData)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="n">log</span><span class="o">.</span><span class="n">event_name</span><span class="o">.</span><span class="n">localized_value</span><span class="p">,</span>
        <span class="n">log</span><span class="o">.</span><span class="n">operation_name</span><span class="o">.</span><span class="n">localized_value</span>
    <span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="metrics">
<h2>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h2>
<p>This sample get the metrics of a resource on Azure (VMs, etc.).</p>
<p>A complete list of available keywords for filters is available
here: <a class="reference external" href="https://msdn.microsoft.com/en-us/library/azure/mt743622.aspx">https://msdn.microsoft.com/en-us/library/azure/mt743622.aspx</a></p>
<p>Supported metrics per resource type is available here:
<a class="reference external" href="https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics">https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="c1"># Get the ARM id of your resource. You might chose to do a &quot;get&quot;</span>
<span class="c1"># using the according management or to build the URL directly</span>
<span class="c1"># Example for a ARM VM</span>
<span class="n">resource_id</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;subscriptions/{}/&quot;</span>
    <span class="s2">&quot;resourceGroups/{}/&quot;</span>
    <span class="s2">&quot;providers/Microsoft.Compute/virtualMachines/{}&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subscription_id</span><span class="p">,</span> <span class="n">resource_group_name</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">)</span>

<span class="c1"># You can get the available metrics of this specific resource</span>
<span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">metric_definitions</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">resource_id</span><span class="p">):</span>
    <span class="c1"># azure.monitor.models.MetricDefinition</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: id={}, unit={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">localized_value</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">unit</span>
    <span class="p">))</span>

<span class="c1"># Example of result for a VM:</span>
<span class="c1"># Percentage CPU: id=Percentage CPU, unit=Unit.percent</span>
<span class="c1"># Network In: id=Network In, unit=Unit.bytes</span>
<span class="c1"># Network Out: id=Network Out, unit=Unit.bytes</span>
<span class="c1"># Disk Read Bytes: id=Disk Read Bytes, unit=Unit.bytes</span>
<span class="c1"># Disk Write Bytes: id=Disk Write Bytes, unit=Unit.bytes</span>
<span class="c1"># Disk Read Operations/Sec: id=Disk Read Operations/Sec, unit=Unit.count_per_second</span>
<span class="c1"># Disk Write Operations/Sec: id=Disk Write Operations/Sec, unit=Unit.count_per_second</span>

<span class="c1"># Get CPU total of yesterday for this VM, by hour</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="n">yesterday</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
    <span class="s2">&quot;name.value eq &#39;Percentage CPU&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;aggregationType eq &#39;Total&#39;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;startTime eq {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yesterday</span><span class="p">),</span>
    <span class="s2">&quot;endTime eq {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">today</span><span class="p">),</span>
    <span class="s2">&quot;timeGrain eq duration&#39;PT1H&#39;&quot;</span>
<span class="p">])</span>

<span class="n">metrics_data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
    <span class="n">resource_id</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">metrics_data</span><span class="p">:</span>
    <span class="c1"># azure.monitor.models.Metric</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} ({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">localized_value</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="c1"># azure.monitor.models.MetricData</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time_stamp</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">total</span><span class="p">))</span>

<span class="c1"># Example of result:</span>
<span class="c1"># Percentage CPU (percent)</span>
<span class="c1"># 2016-11-16 00:00:00+00:00: 72.0</span>
<span class="c1"># 2016-11-16 01:00:00+00:00: 90.59</span>
<span class="c1"># 2016-11-16 02:00:00+00:00: 60.58</span>
<span class="c1"># 2016-11-16 03:00:00+00:00: 65.78</span>
<span class="c1"># 2016-11-16 04:00:00+00:00: 43.96</span>
<span class="c1"># 2016-11-16 05:00:00+00:00: 43.96</span>
<span class="c1"># 2016-11-16 06:00:00+00:00: 114.9</span>
<span class="c1"># 2016-11-16 07:00:00+00:00: 45.4</span>
<span class="c1"># 2016-11-16 08:00:00+00:00: 57.59</span>
<span class="c1"># 2016-11-16 09:00:00+00:00: 67.85</span>
<span class="c1"># 2016-11-16 10:00:00+00:00: 76.36</span>
<span class="c1"># 2016-11-16 11:00:00+00:00: 87.41</span>
<span class="c1"># 2016-11-16 12:00:00+00:00: 67.53</span>
<span class="c1"># 2016-11-16 13:00:00+00:00: 64.78</span>
<span class="c1"># 2016-11-16 14:00:00+00:00: 66.55</span>
<span class="c1"># 2016-11-16 15:00:00+00:00: 69.82</span>
<span class="c1"># 2016-11-16 16:00:00+00:00: 96.02</span>
<span class="c1"># 2016-11-16 17:00:00+00:00: 272.52</span>
<span class="c1"># 2016-11-16 18:00:00+00:00: 96.41</span>
<span class="c1"># 2016-11-16 19:00:00+00:00: 83.92</span>
<span class="c1"># 2016-11-16 20:00:00+00:00: 95.57</span>
<span class="c1"># 2016-11-16 21:00:00+00:00: 146.73</span>
<span class="c1"># 2016-11-16 22:00:00+00:00: 73.86</span>
<span class="c1"># 2016-11-16 23:00:00+00:00: 84.7</span>
</pre></div>
</div>
</div>
<div class="section" id="alert-rules">
<h2>Alert rules<a class="headerlink" href="#alert-rules" title="Permalink to this headline">¶</a></h2>
<p>This section shows how you can use the Python SDK to configure Azure metrics alerts.
This enables you to automatically set up alerts on your resources when they are created to ensure that
all resources are monitored correctly.</p>
<p>You need the <cite>azure-mgmt-monitor</cite> package for this feature.</p>
<p>You need to define three objects:</p>
<ul class="simple">
<li><p>A data source</p></li>
<li><p>A condition on this data source</p></li>
<li><p>At least one action</p></li>
</ul>
<p>There two possible data source:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/python/api/azure.mgmt.monitor.models.rulemetricdatasource">RuleMetricDataSource</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/python/api/azure.mgmt.monitor.models.rulemanagementeventdatasource">RuleManagementEventDataSource</a></p></li>
</ul>
<p>For instance, to create a data source on a VM to alert on CPU usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">azure.mgmt.monitor.models</span> <span class="kn">import</span> <span class="n">RuleMetricDataSource</span>

<span class="n">resource_id</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;subscriptions/{}/&quot;</span>
    <span class="s2">&quot;resourceGroups/MonitorTestsDoNotDelete/&quot;</span>
    <span class="s2">&quot;providers/Microsoft.Compute/virtualMachines/MonitorTest&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">SUBSCRIPTION_ID</span><span class="p">)</span>

<span class="c1"># I need a subclass of &quot;RuleDataSource&quot;</span>
<span class="n">data_source</span> <span class="o">=</span> <span class="n">RuleMetricDataSource</span><span class="p">(</span>
    <span class="n">resource_uri</span> <span class="o">=</span> <span class="n">resource_id</span><span class="p">,</span>
    <span class="n">metric_name</span> <span class="o">=</span> <span class="s1">&#39;Percentage CPU&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Supported metrics per resource type is available here:
<a class="reference external" href="https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics">https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics</a></p>
<p>There is three possible conditions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/python/api/azure.mgmt.monitor.models.thresholdrulecondition">ThresholdRuleCondition</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/python/api/azure.mgmt.monitor.models.locationthresholdrulecondition">LocationThresholdRuleCondition</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/python/api/azure.mgmt.monitor.models.managementeventrulecondition">ManagementEventRuleCondition</a></p></li>
</ul>
<p>For instance, to create a threshold condition that triggers when the average CPU
usage of a VM for the last 5 minutes is above 90% (using the preceding data source):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">azure.mgmt.monitor.models</span> <span class="kn">import</span> <span class="n">ThresholdRuleCondition</span>

<span class="c1"># I need a subclasses of &quot;RuleCondition&quot;</span>
<span class="n">rule_condition</span> <span class="o">=</span> <span class="n">ThresholdRuleCondition</span><span class="p">(</span>
    <span class="n">data_source</span> <span class="o">=</span> <span class="n">data_source</span><span class="p">,</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;GreaterThanOrEqual&#39;</span><span class="p">,</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>
    <span class="n">window_size</span> <span class="o">=</span> <span class="s1">&#39;PT5M&#39;</span><span class="p">,</span>
    <span class="n">time_aggregation</span> <span class="o">=</span> <span class="s1">&#39;Average&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>There is two possible actions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/python/api/azure.mgmt.monitor.models.ruleemailaction">RuleEmailAction</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/python/api/azure.mgmt.monitor.models.rulewebhookaction">RuleWebhookAction</a></p></li>
</ul>
<p>For instance, to create an email action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">azure.mgmt.monitor.models</span> <span class="kn">import</span> <span class="n">RuleEmailAction</span>

<span class="c1"># I need a subclass of &quot;RuleAction&quot;</span>
<span class="n">rule_action</span> <span class="o">=</span> <span class="n">RuleEmailAction</span><span class="p">(</span>
    <span class="n">send_to_service_owners</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">custom_emails</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;monitoringemail@microsoft.com&#39;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Once you defined these thress objects that fit your needs, create the alert is a simple call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span> <span class="o">=</span> <span class="s1">&#39;MyPyTestAlertRule&#39;</span>
<span class="n">my_alert</span> <span class="o">=</span> <span class="n">monitor_mgmt_client</span><span class="o">.</span><span class="n">alert_rules</span><span class="o">.</span><span class="n">create_or_update</span><span class="p">(</span>
    <span class="n">group_name</span><span class="p">,</span>
    <span class="n">rule_name</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;westus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;alert_rule_resource_name&#39;</span><span class="p">:</span> <span class="n">rule_name</span><span class="p">,</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Testing Alert rule creation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;is_enabled&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="n">rule_condition</span><span class="p">,</span>
        <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">rule_action</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sample_azure-keyvault.html" class="btn btn-neutral float-right" title="KeyVault" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="batch.html" class="btn btn-neutral float-left" title="Batch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Microsoft

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-62780441-36"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-62780441-36');
</script>


</body>
</html>